pipeline{

      agent any
        tools {
     jdk 'JAVA_HOME'
     maven 'M2_HOME'
     
  }
  environment {

         DOCKERHUB_CREDENTIALS = credentials('dockerhub')}
     
        
        stages{

            
	     stage('Build docker image'){
                             steps{
                                 script{
                                    sh 'docker build -t $DOCKERHUB_CREDENTIALS_USR/springprojet .'
                                 }
                             }
                         }
	     stage('Docker login') {

                                         steps {
					 script{
                                          sh 'echo "login Docker ...."'
                   	sh 'docker login -u $DOCKERHUB_CREDENTIALS_USR -p $DOCKERHUB_CREDENTIALS_PSW'
                               }  }}
		 stage('Docker push') {

                 steps {
		 script{
                      sh 'echo "Docker is pushing ...."'
                     	sh 'docker push $DOCKERHUB_CREDENTIALS_USR/springprojet'
                        }  }}
         stage('Docker compose') {

                          steps {
			  script{
                               sh 'docker-compose up -d'
                                 }  }}
        }
}


